<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WeightedLowess: Weighted LOWESS for C++</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WeightedLowess
   </div>
   <div id="projectbrief">C++ API for different matrix representations</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Weighted LOWESS for C++ </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__github_workspace_README"></a> </p><h1>Overview</h1>
<p>A header-only C++ library for weighted LOWESS calculations, directly ported from the <code>weightedLowess()</code> function in the <a href="https://bioconductor.org/packages/limma/"><b>limma</b></a> package. This implements the method described by Cleveland (1979, 1981):</p>
<ol type="1">
<li>Define a set of anchor points, more-or-less evenly spaced throughout the range of x-values.</li>
<li>Perform a local linear regression around each anchor, using only points within a window centered at each anchor. In this regression, points inside the windoware weighted based on their distances from the anchor on the x-axis. Each anchor's window must be wide enough to contain a given proportion of all points.</li>
<li>Interpolate to obtain smoothed values for all points in between two anchors.</li>
<li>Weight each point based on their residual, i.e., difference from the fitted value. Points with very large residuals are assigned zero weight.</li>
<li>Repeat steps 1-5 using the computed weights in each anchor's local linear regression. This is iterated several times to eliminate the effect of outliers on the fit.</li>
</ol>
<p>In here and <code>limma::weightedLowess</code>, we implement some (optional) modifications from the original FORTRAN code:</p>
<ul>
<li>We allow weights to be interpreted as frequencies, in which case they are used in determining the width of the smoothing window around each point. This is in addition to their usual role in the local linear regression.</li>
<li>The <code>delta</code> value can be automatically determined from a pre-specified number of anchor points. This provides a convenient way of controlling the approximation fidelity.</li>
</ul>
<p>In this library, we also implement some modifications from <code>limma::weightedLowess</code>:</p>
<ul>
<li>The number of robustness iterations in this library refers to additional iterations beyond the first fit, while the number of robustness iterations in <code>limma:;weightedLowess</code> includes the first fit.</li>
<li>We omit the early termination condition when the MAD of the residuals is much lower than the mean. This avoids inappropriate termination of the robustness iterations in pathological scenarios.</li>
</ul>
<p>See the <a href="https://rdrr.io/bioc/limma/man/weightedLowess.html"><code>?weightedLowess</code> documentation</a> for more details.</p>
<h1>Usage</h1>
<p>Using this library is as simple as including the header file in your source code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="WeightedLowess_8hpp.html">WeightedLowess/WeightedLowess.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="classWeightedLowess_1_1WeightedLowess.html">WeightedLowess::WeightedLowess</a> smoother;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Optional: set parameters.</span></div>
<div class="line">smoother.<a class="code" href="classWeightedLowess_1_1WeightedLowess.html#a346936b142a499ba9ffa10805e6f5eb2">set_span</a>(0.5).<a class="code" href="classWeightedLowess_1_1WeightedLowess.html#a82a2425e53d00c760a401b2c013b10f8">set_anchors</a>(100);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Run on some input values.</span></div>
<div class="line"><span class="keyword">auto</span> results = smoother.<a class="code" href="classWeightedLowess_1_1WeightedLowess.html#af24c296590119c25d844eff1edd4169d">run</a>(num_points, x, y);</div>
<div class="line">results.fitted;</div>
<div class="ttc" id="aWeightedLowess_8hpp_html"><div class="ttname"><a href="WeightedLowess_8hpp.html">WeightedLowess.hpp</a></div></div>
<div class="ttc" id="aclassWeightedLowess_1_1WeightedLowess_html"><div class="ttname"><a href="classWeightedLowess_1_1WeightedLowess.html">WeightedLowess::WeightedLowess</a></div><div class="ttdoc">Run the weighted LOWESS algorithm given vectors of x- and y-coordinates (and possibly weights).</div><div class="ttdef"><b>Definition:</b> WeightedLowess.hpp:25</div></div>
<div class="ttc" id="aclassWeightedLowess_1_1WeightedLowess_html_a346936b142a499ba9ffa10805e6f5eb2"><div class="ttname"><a href="classWeightedLowess_1_1WeightedLowess.html#a346936b142a499ba9ffa10805e6f5eb2">WeightedLowess::WeightedLowess::set_span</a></div><div class="ttdeci">WeightedLowess &amp; set_span(double s=0.3)</div><div class="ttdef"><b>Definition:</b> WeightedLowess.hpp:37</div></div>
<div class="ttc" id="aclassWeightedLowess_1_1WeightedLowess_html_a82a2425e53d00c760a401b2c013b10f8"><div class="ttname"><a href="classWeightedLowess_1_1WeightedLowess.html#a82a2425e53d00c760a401b2c013b10f8">WeightedLowess::WeightedLowess::set_anchors</a></div><div class="ttdeci">WeightedLowess &amp; set_anchors(int p=200)</div><div class="ttdef"><b>Definition:</b> WeightedLowess.hpp:53</div></div>
<div class="ttc" id="aclassWeightedLowess_1_1WeightedLowess_html_af24c296590119c25d844eff1edd4169d"><div class="ttname"><a href="classWeightedLowess_1_1WeightedLowess.html#af24c296590119c25d844eff1edd4169d">WeightedLowess::WeightedLowess::run</a></div><div class="ttdeci">void run(size_t n, const double *x, const double *y, const double *weights, double *fitted, double *robust_weights)</div><div class="ttdef"><b>Definition:</b> WeightedLowess.hpp:567</div></div>
</div><!-- fragment --><p>See the <a href="https://ltla.github.io/CppWeightedLowess">reference documentation</a> for more details.</p>
<p>If you're already using CMake, then you just need to add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  WeightedLowess </div>
<div class="line">  GIT_REPOSITORY https://github.com/LTLA/CppWeightedLowess</div>
<div class="line">  GIT_TAG master # or any version of interest</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(tatami)</div>
</div><!-- fragment --><p>And then:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe WeightedLowess)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE WeightedLowess)</div>
</div><!-- fragment --><p>Otherwise, you can just copy the header file into some location that is visible to your compiler.</p>
<h1>References</h1>
<p>Cleveland, W.S. (1979). Robust locally weighted regression and smoothing scatterplots. <em>Journal of the American Statistical Association</em> 74(368), 829-836.</p>
<p>Cleveland, W.S. (1981). LOWESS: A program for smoothing scatterplots by robust locally weighted regression. <em>The American Statistician</em> 35(1), 54. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
