<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WeightedLowess: Weighted LOWESS for C++</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">WeightedLowess
   </div>
   <div id="projectbrief">A C++ library for LOWESS with various weighting schemes</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Weighted LOWESS for C++ </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__github_workspace_README"></a> <img src="https://github.com/LTLA/CppWeightedLowess/actions/workflows/run-tests.yaml/badge.svg" alt="Unit tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/LTLA/CppWeightedLowess/actions/workflows/doxygenate.yaml/badge.svg" alt="Documentation" style="pointer-events: none;" class="inline"/> <img src="https://github.com/LTLA/CppWeightedLowess/actions/workflows/compare-limma.yaml/badge.svg" alt="Limma comparison" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/LTLA/CppWeightedLowess"><img src="https://codecov.io/gh/LTLA/CppWeightedLowess/branch/master/graph/badge.svg?token=GBHWVK9MFY" alt="Codecov" style="pointer-events: none;" class="inline"/></a></p>
<h1>Overview</h1>
<p>This C++ library implements the Locally Weighted Scatterplot Smoothing (LOWESS) method described by Cleveland (1979, 1981). LOWESS is a non-parametric smoothing algorithm that is simple and computationally efficient yet can accommodate a wide variety of curves. The libary itself is header-only and thus can be easily used in any C++ project by adding the relevant <code>#include</code> directives. This implementation is derived from the <a href="https://bioconductor.org/packages/limma/"><b>limma</b></a> package and contains some modifications from Cleveland's original code. Of particular interest is the ability to treat the weights as frequencies such that they are involved in the window span calculations for each anchor point - hence the name.</p>
<h1>Algorithm details</h1>
<p>Cleveland's original Fortran implementation is quite simple:</p>
<ol type="1">
<li>Define a set of anchor points, more-or-less evenly spaced throughout the range of x-values.</li>
<li>Perform a local linear regression around each anchor, using only points within a window centered at each anchor. In this regression, points inside the window are weighted based on their distances from the anchor on the x-axis. (If additional sets of weights are provided, the product of weights is used for each point.) Each anchor's window must be wide enough to contain a given proportion of all points.</li>
<li>Interpolate to obtain smoothed values for all points in between two anchors.</li>
<li>Compute a robustness weight for each point based on the absolute value of its residual from the fitted value. Points with very large residuals are considered outliers and are assigned zero weight.</li>
<li>Repeat steps 1-5 using the computed weights in each anchor's local linear regression. This is iterated several times to eliminate the effect of outliers on the fit.</li>
</ol>
<p>In <code>limma::weightedLowess</code>, we implemented some (optional) modifications that are also available in this library. See the <a href="https://rdrr.io/bioc/limma/man/weightedLowess.html"><code>?weightedLowess</code> documentation</a> for more details.</p>
<ul>
<li>If additional weights are specified, we allow them to be interpreted as frequencies. As a result, the weights are used in determining the width of the smoothing window around each anchor, in addition to their usual role in the local linear regression.</li>
<li>The <code>delta</code> value can be automatically determined from a pre-specified number of anchor points. This provides a convenient way of controlling the approximation fidelity.</li>
</ul>
<p>In this library, we implement some further modifications from <code>limma::weightedLowess</code>:</p>
<ul>
<li>The number of robustness iterations in this library refers to additional iterations beyond the first fit, while the number of robustness iterations in <code>limma::weightedLowess</code> includes the first fit. So 3 iterations here are equivalent to 4 iterations in <code>limma::weightedLowess</code>.</li>
<li>We omit the early termination condition when the MAD of the residuals is much lower than the mean. This avoids inappropriate termination of the robustness iterations in pathological scenarios.</li>
<li>We provide extra protection for the edge case where the robustness weighting causes the sum of weights in a window to be zero. In such cases, we simply ignore the robustness weights when computing the smoothed value.</li>
</ul>
<h1>Usage</h1>
<p>Using this library is as simple as including the header file in your source code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="WeightedLowess_8hpp.html">WeightedLowess/WeightedLowess.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// ... standard boilerplate here...</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classWeightedLowess_1_1WeightedLowess.html">WeightedLowess::WeightedLowess</a> smoother;</div>
<div class="line"><span class="keyword">auto</span> results = smoother.<a class="code hl_function" href="classWeightedLowess_1_1WeightedLowess.html#a60d3060eabf5ba64313914e8b199b59f">run</a>(num_points, x, y);</div>
<div class="line">results.fitted;</div>
<div class="ttc" id="aWeightedLowess_8hpp_html"><div class="ttname"><a href="WeightedLowess_8hpp.html">WeightedLowess.hpp</a></div><div class="ttdoc">LOWESS implementation generalized for frequency weights.</div></div>
<div class="ttc" id="aclassWeightedLowess_1_1WeightedLowess_html"><div class="ttname"><a href="classWeightedLowess_1_1WeightedLowess.html">WeightedLowess::WeightedLowess</a></div><div class="ttdoc">Run a (weighted) LOWESS algorithm from vectors of x- and y-coordinates.</div><div class="ttdef"><b>Definition:</b> WeightedLowess.hpp:30</div></div>
<div class="ttc" id="aclassWeightedLowess_1_1WeightedLowess_html_a60d3060eabf5ba64313914e8b199b59f"><div class="ttname"><a href="classWeightedLowess_1_1WeightedLowess.html#a60d3060eabf5ba64313914e8b199b59f">WeightedLowess::WeightedLowess::run</a></div><div class="ttdeci">void run(size_t n, const Data_t *x, const Data_t *y, const Data_t *weights, Data_t *fitted, Data_t *robust_weights) const</div><div class="ttdef"><b>Definition:</b> WeightedLowess.hpp:697</div></div>
</div><!-- fragment --><p>We can set parameters in the <code>WeightedLowess</code> instance by calling the various <code>set_*</code> methods. Note that these changes will persist for the lifetime of the object (or until they are changed back).</p>
<div class="fragment"><div class="line"><span class="comment">// Optional: set parameters.</span></div>
<div class="line">smoother.<a class="code hl_function" href="classWeightedLowess_1_1WeightedLowess.html#a4a559032612dcf9c75f944030e28560c">set_span</a>(0.5).<a class="code hl_function" href="classWeightedLowess_1_1WeightedLowess.html#aa7b6a6f3deb658900f3917f9542a0ceb">set_anchors</a>(100);</div>
<div class="line"><span class="keyword">auto</span> results2 = smoother.<a class="code hl_function" href="classWeightedLowess_1_1WeightedLowess.html#a60d3060eabf5ba64313914e8b199b59f">run</a>(num_points, x, y);</div>
<div class="ttc" id="aclassWeightedLowess_1_1WeightedLowess_html_a4a559032612dcf9c75f944030e28560c"><div class="ttname"><a href="classWeightedLowess_1_1WeightedLowess.html#a4a559032612dcf9c75f944030e28560c">WeightedLowess::WeightedLowess::set_span</a></div><div class="ttdeci">WeightedLowess &amp; set_span(Data_t s=Defaults::span)</div><div class="ttdef"><b>Definition:</b> WeightedLowess.hpp:88</div></div>
<div class="ttc" id="aclassWeightedLowess_1_1WeightedLowess_html_aa7b6a6f3deb658900f3917f9542a0ceb"><div class="ttname"><a href="classWeightedLowess_1_1WeightedLowess.html#aa7b6a6f3deb658900f3917f9542a0ceb">WeightedLowess::WeightedLowess::set_anchors</a></div><div class="ttdeci">WeightedLowess &amp; set_anchors(int p=Defaults::anchors)</div><div class="ttdef"><b>Definition:</b> WeightedLowess.hpp:131</div></div>
</div><!-- fragment --><p>If users already have an appropriate buffer for the fitted values and residuals, they can be filled directly with the results:</p>
<div class="fragment"><div class="line">std::vector&lt;double&gt; fitted(num_points), resids(num_points);</div>
<div class="line">smoother.<a class="code hl_function" href="classWeightedLowess_1_1WeightedLowess.html#a60d3060eabf5ba64313914e8b199b59f">run</a>(num_points, x, y, NULL, fitted.data(), resids.data());</div>
</div><!-- fragment --><p>See the <a href="https://ltla.github.io/CppWeightedLowess">reference documentation</a> for more details.</p>
<h1>Building projects</h1>
<p>If you're already using CMake, you can add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  WeightedLowess </div>
<div class="line">  GIT_REPOSITORY https://github.com/LTLA/CppWeightedLowess</div>
<div class="line">  GIT_TAG master # or any version of interest</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(tatami)</div>
</div><!-- fragment --><p>And then:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe WeightedLowess)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE WeightedLowess)</div>
</div><!-- fragment --><p>Otherwise, you can just copy the header file into some location that is visible to your compiler.</p>
<h1>References</h1>
<p>Cleveland, W.S. (1979). Robust locally weighted regression and smoothing scatterplots. <em>Journal of the American Statistical Association</em> 74(368), 829-836.</p>
<p>Cleveland, W.S. (1981). LOWESS: A program for smoothing scatterplots by robust locally weighted regression. <em>The American Statistician</em> 35(1), 54. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
